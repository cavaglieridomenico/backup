<!-- My account gdpr-->
<script type="text/javascript">
  ; (function () {
    var pushState = history.pushState;
    var replaceState = history.replaceState;

    history.pushState = function () {
      pushState.apply(history, arguments);
      window.dispatchEvent(new Event('pushstate'));
      window.dispatchEvent(new Event('locationchangeaccount'));
    };

    history.replaceState = function () {
      replaceState.apply(history, arguments);
      window.dispatchEvent(new Event('replacestate'));
      window.dispatchEvent(new Event('locationchangeaccount'));
    };

    window.addEventListener('popstate', function () {
      window.dispatchEvent(new Event('locationchangeaccount'))
    });

    window.addEventListener('resize', function () {
      window.dispatchEvent(new Event('locationchangeaccount'))
    });

    window.addEventListener('load', function () {
      window.dispatchEvent(new Event('locationchangeaccount'))
    });
    
  })();

  window.addEventListener('locationchangeaccount', function () {
    if (window.location.href.indexOf('account') > 0 && window.location.hash && window.location.hash == '#/profile') {
      waitForEl('.vtex-my-account-1-x-newsletterContainerMessage', function () {
        document.querySelector('.vtex-my-account-1-x-newsletterContainerMessage').textContent='Ho compreso e prendo atto del contenuto dell’'
        let optin = document.createElement('div')
        optin.innerHTML = "<a class='vtex-rich-text-0-x-link vtex-rich-text-0-x-link--spaziature-impaginazione vtex-rich-text-0-x-link--paragraph-text-page' href=\"/pagine/informativa-sulla-privacy\" target=\"_blank\">Informativa sulla privacy</a> e"
        document.querySelector('.vtex-my-account-1-x-newsletterContainerMessage').appendChild(optin)
        document.querySelector("label[for='newsletterOptIn']").style.textAlign = "justify";
        document.querySelector("label[for='newsletterOptIn']").textContent='Acconsento al trattamento dei miei dati personali per permettere a Whirlpool Italia Srl di inviarmi newsletter/comunicazioni di marketing (in forma elettronica e non, anche tramite telefono, posta tradizionale, e-mail, SMS, notifiche push su siti di terze parti tra cui sulle piattaforme Facebook e Google) riguardanti prodotti e servizi di Whirlpool Italia Srl, anche da me acquistati o registrati, nonché di svolgere ricerche di mercato. Con la registrazione potrò usufruire di uno sconto del 5% valido sul primo acquisto effettuato entro 12 mesi dalla registrazione. Sconto cumulabile con le altre offerte in essere.'
      })

      waitForEl('#newsletterOptIn', function () {
        const checkbox = document.getElementById('newsletterOptIn')

        checkbox.addEventListener('change', (event) => {
          event.stopPropagation();
          event.stopImmediatePropagation();
          let dataLayer = window.dataLayer || []
          if (event.currentTarget.checked){
            dataLayer.push({
              event: "optin_granted"
            })
          }
        })
      })
    }
  })

  function setEventiListener(element, type, callback) {
    let listOfElements = document.querySelectorAll(element)
    if (listOfElements && listOfElements.length > 0) {
      listOfElements.forEach(e => {
        e.addEventListener(type, callback)
      })
      return
    } else {
      setTimeout(() => setEventiListener(element, type, callback), 250)
    }
  }

  setEventiListener('.vtex-address-form__state input','focus', (event) =>{
    document.querySelector('.vtex-address-form__state input').attr('maxLength', 2)
  })

  var waitForEl = function (selector, callback) {
    let element = document.querySelector(selector)
    if (element && (window.getComputedStyle(element).visibility == 'visible' || document.querySelector(selector).length > 0)) {
      callback()
    } else {
      setTimeout(function () {
        waitForEl(selector, callback)
      }, 100)
    }
  }
</script>
